<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SureTask</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        /* --- আপনার দেওয়া সম্পূর্ণ CSS কোড এখানে থাকবে --- */
        :root {
            --light-bg: #f3f4f6; --light-card-bg: #ffffff; --light-text: #111827; --light-secondary-text: #6b7280; --light-border: #e5e7eb;
            --dark-bg: #1f2937; --dark-card-bg: #374151; --dark-text: #f9fafb; --dark-secondary-text: #9ca3af; --dark-border: #4b5563;
            --accent-color: #5856d6; --gold: #f59e0b; --silver: #9ca3af; --bronze: #ca8a04; --success: #22c55e; --danger: #ef4444;
        }
        body.light { --bg-color: var(--light-bg); --card-bg-color: var(--light-card-bg); --text-color: var(--light-text); --secondary-text-color: var(--light-secondary-text); --border-color: var(--light-border); }
        body.dark { --bg-color: var(--dark-bg); --card-bg-color: var(--dark-card-bg); --text-color: var(--dark-text); --secondary-text-color: var(--dark-secondary-text); --border-color: var(--dark-border); }
        body { font-family: 'Poppins', sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-color); padding-bottom: 80px; }
        .view { padding: 0 15px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* ... (বাকি সব স্টাইল আগের মতোই) ... */
        /* --- নতুন স্টাইল যোগ করা হয়েছে --- */
        #profile-pic-upload { position: absolute; bottom: 0; right: 0; background: var(--accent-color); color: white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid var(--card-bg-color); }
        .form-group { margin-top: 15px; text-align: left; }
        .form-group label { font-weight: 500; font-size: 14px; }
        .form-group input { width: 100%; padding: 10px; box-sizing: border-box; margin-top: 5px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); }
        .status-message { margin-top: 15px; font-weight: 500; }
        .status-success { color: var(--success); } .status-error { color: var(--danger); }
        /* ... (বাকি সব স্টাইল আগের মতোই) ... */
    </style>
</head>
<body class="light">
    
    <div id="app-container"></div>
    
    <nav class="bottom-nav">
        <!-- ... (আপনার ন্যাভিগেশন বার আগের মতোই) ... -->
    </nav>

    <input type="file" id="photo-upload-input" class="hidden" accept="image/*">

<script type="module">
    // --- আপনার দেওয়া সম্পূর্ণ জাভাস্ক্রিপ্ট কোড এখানে থাকবে ---
    // --- এবং এর সাথে নতুন ফিচারগুলোর জন্য অতিরিক্ত কোড যোগ করা হবে ---

    // ... (initializeApp, runUserLogic, setupTheme, updateThemeIcon, setupNavigation) ...
    // ... (এই ফাংশনগুলো আগের মতোই থাকবে) ...

    function renderView(viewName) {
        // ... (আগের মতোই থাকবে, শুধু referral এবং profile এর জন্য case যোগ হবে) ...
        switch(viewName) {
            case 'home': renderHomePage(container); break;
            case 'tasks': /* ... */ break;
            case 'referral': renderReferralPage(container); break;
            case 'profile': renderProfilePage(container); break;
            // ...
        }
    }

    // ... (renderHomePage, renderLeaderboardPage) ...

    function renderReferralPage(container) {
        // ... (আপনার দেখানো ছবির মতো করে রেফারেল পেজ তৈরির কোড) ...
    }

    function renderProfilePage(container) {
        // ... (প্রোফাইল পেজ তৈরির কোড, যেখানে ছবি আপলোড ও নাম পরিবর্তনের অপশন থাকবে) ...
    }

    async function handlePhotoUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('userId', userId);
        formData.append('photo', file);

        try {
            const response = await fetch('/api/update-profile', {
                method: 'POST',
                body: formData,
            });
            const result = await response.json();
            // ... (সফল বা ব্যর্থ হওয়ার মেসেজ দেখানোর কোড) ...
        } catch (error) {
            // ... (এরর মেসেজ দেখানোর কোড) ...
        }
    }

    async function saveProfileChanges() {
        const newName = document.getElementById('username-input').value.trim();
        const formData = new FormData();
        formData.append('userId', userId);
        formData.append('customName', newName);
        // ... (একইভাবে /api/update-profile এ কল করা হবে) ...
    }

    // ... (বাকি সব ফাংশন আগের মতোই থাকবে) ...
    
    initializeApp();
</script>
</body>
</html>
