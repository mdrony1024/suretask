<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SureTask Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f7f6; margin: 0; }
        #login-section { display: flex; justify-content: center; align-items: center; height: 100vh; }
        .login-box { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; }
        .login-box input { display: block; width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
        .login-box button { width: 100%; padding: 10px; background: #5856d6; color: white; border: none; cursor: pointer; }
        #admin-panel { display: none; } /* শুরুতে অ্যাডমিন প্যানেল লুকানো থাকবে */
        /* ... আরও অনেক স্টাইল যোগ করা যেতে পারে ... */
    </style>
</head>
<body>

    <!-- লগইন সেকশন -->
    <section id="login-section">
        <div class="login-box">
            <h2>Admin Panel Login</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button id="login-btn">Login</button>
            <p id="login-error" style="color:red;"></p>
        </div>
    </section>

    <!-- অ্যাডমিন প্যানেল সেকশন -->
    <section id="admin-panel">
        <header>
            <h1>SureTask Dashboard</h1>
            <button id="logout-btn">Logout</button>
        </header>
        <main>
            <!-- এখানে ড্যাশবোর্ড, ইউজার, টাস্ক ইত্যাদি ট্যাব থাকবে -->
            <h2>Welcome, Admin!</h2>
            <p>Full admin panel functionality can be built out here.</p>
        </main>
    </section>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('/api/config');
            const firebaseConfig = await response.json();
            firebase.initializeApp(firebaseConfig);
            
            const auth = firebase.auth();
            const loginSection = document.getElementById('login-section');
            const adminPanel = document.getElementById('admin-panel');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const loginError = document.getElementById('login-error');

            // ব্যবহারকারী লগইন করা আছে কিনা তা চেক করা
            auth.onAuthStateChanged(async user => {
                if (user) {
                    // ব্যবহারকারী লগইন করা, এখন সে অ্যাডমিন কিনা চেক করতে হবে
                    const idTokenResult = await user.getIdTokenResult();
                    if (idTokenResult.claims.admin) {
                        // হ্যাঁ, ইনি অ্যাডমিন!
                        loginSection.style.display = 'none';
                        adminPanel.style.display = 'block';
                    } else {
                        // অ্যাডমিন নন, তাই লগআউট করে দেওয়া হবে
                        alert('You are not authorized to access this panel.');
                        auth.signOut();
                    }
                } else {
                    // কেউ লগইন করা নেই, তাই লগইন পেজ দেখানো হবে
                    loginSection.style.display = 'flex';
                    adminPanel.style.display = 'none';
                }
            });

            // লগইন বাটন
            loginBtn.addEventListener('click', async () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                loginError.innerText = '';
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    loginError.innerText = error.message;
                }
            });

            // লগআউট বাটন
            logoutBtn.addEventListener('click', () => {
                auth.signOut();
            });

        } catch (e) {
            console.error(e);
            document.body.innerHTML = 'Failed to load app configuration.';
        }
    });
</script>
</body>
</html>
