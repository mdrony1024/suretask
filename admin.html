// admin.html-এর ভেতরে এই দুটি ফাংশন আপডেট করুন

async function loadTasks() {
    renderHTML('<p>Loading tasks...</p>');
    try {
        const tasks = await fetchData('/api/admin?type=tasks');
        let tableRows = tasks.map(task => `<tr><td>${task.title}</td><td>${task.category || 'N/A'}</td><td>${task.taskType || 'general'}</td><td>${task.points}</td><td><button class="action-btn ban-btn" onclick="deleteTask('${task.id}')">Delete</button></td></tr>`).join('');
        renderHTML(`
            <div class="form-card">
                <h3>Create Admin Task</h3>
                <form id="task-form">
                    <input id="task-title" placeholder="Title" required>
                    <input id="task-points" type="number" placeholder="Points" required>
                    <select id="task-category" required>
                        <option value="" disabled selected>Select Category</option>
                        <option value="group">TG Group Member</option>
                        <option value="channel">TG Channel Member</option>
                        <option value="tg_views">Telegram Views</option>
                        <option value="yt_views">YouTube Views</option>
                        <option value="bot_start">Bot START</option>
                    </select>
                    <select id="task-type" required>
                        <option value="general">General (One time)</option>
                        <option value="daily">Daily (Once per day)</option>
                    </select>
                    <input id="task-url" placeholder="URL" required>
                    <button type="submit">Create Task</button>
                </form>
            </div>
            <table>
                <thead><tr><th>Title</th><th>Category</th><th>Type</th><th>Points</th><th>Action</th></tr></thead>
                <tbody>${tableRows}</tbody>
            </table>
        `);
        document.getElementById('task-form').addEventListener('submit', createTask);
    } catch (e) { renderHTML(`<p style="color:red;">Error: ${e.message}</p>`); }
}

async function createTask(e) {
    e.preventDefault();
    const task = {
        title: document.getElementById('task-title').value,
        points: Number(document.getElementById('task-points').value),
        category: document.getElementById('task-category').value,
        taskType: document.getElementById('task-type').value, // taskType যোগ করা হয়েছে
        url: document.getElementById('task-url').value,
    };
    try {
        await fetch('/api/admin?type=tasks', { method: 'POST', headers: { 'Authorization': `Bearer ${idToken}`, 'Content-Type': 'application/json' }, body: JSON.stringify(task) });
        loadTasks();
    } catch (e) { alert('Failed to create task.'); }
}```

### **ধাপ ২: `tasks.html` ফাইলটি সম্পূর্ণ পরিবর্তন করুন**

এখন, আপনার টাস্ক দেখানোর পেজটিকে সম্পূর্ণ পরিবর্তন করতে হবে। এই নতুন কোডটি অ্যাডমিনের টাস্ক (General এবং Daily) এবং ব্যবহারকারীদের প্রমোশন আলাদাভাবে দেখাবে।

অনুগ্রহ করে আপনার `tasks.html` ফাইলের সম্পূর্ণ কোডটি মুছে ফেলে, তার পরিবর্তে নিচের নতুন কোডটি পেস্ট করুন।

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SureTask - Available Tasks</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        /* ... আপনার CSS কোড অপরিবর্তিত থাকবে, শুধু কিছু নতুন ক্লাস যোগ করা হয়েছে ... */
        :root {
            --dark-bg: #1f2937; --dark-card-bg: #374151; --dark-text: #f9fafb; 
            --secondary-text: #9ca3af; --border-color: #4b5563;
            --accent-color: #5856d6; --success: #22c55e; --daily-color: #f59e0b;
        }
        body { font-family: 'Poppins', sans-serif; margin: 0; background-color: var(--dark-bg); color: var(--dark-text); }
        .view { padding: 0 15px; }
        .page-header { display: flex; align-items: center; padding: 15px; }
        .back-button { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--dark-text); margin-right: 10px; }
        .page-header .title { font-size: 20px; font-weight: 600; }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-top: 25px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--accent-color);
        }

        .task-card { 
            background-color: var(--dark-card-bg); 
            border-radius: 15px; 
            padding: 20px; 
            margin-top: 15px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        .task-card.daily::before {
            content: 'DAILY';
            position: absolute;
            top: 10px;
            right: -25px;
            background: var(--daily-color);
            color: white;
            padding: 4px 30px;
            font-size: 10px;
            font-weight: bold;
            transform: rotate(45deg);
        }

        .task-info h3 { margin: 0; font-size: 18px; font-weight: 600; }
        .task-info .points { color: var(--success); font-weight: 600; font-size: 16px; margin-top: 5px; }
        .task-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .task-btn { padding: 12px; border-radius: 12px; border: none; font-size: 16px; font-weight: 500; cursor: pointer; }
        .join-btn { background-color: var(--accent-color); color: white; }
        .verify-btn { background-color: #4b5563; color: var(--dark-text); }
        .verify-btn:disabled { background-color: var(--success); color: white; cursor: not-allowed; }
        .no-tasks { text-align: center; margin-top: 50px; color: var(--secondary-text); }
    </style>
</head>
<body class="dark">
    
    <div class="page-header">
        <button class="back-button" onclick="window.location.href='tasks_home.html'"><i class='bx bx-arrow-back'></i></button>
        <h1 id="page-title" class="title">Tasks</h1>
    </div>

    <div id="tasks-container" class="view"></div>
    
<script>
document.addEventListener('DOMContentLoaded', () => {
    let tg, firestoreDb, userId;
    // ... ক্যাটাগরির নাম ম্যাপ অপরিবর্তিত ...

    async function initializeApp() {
        // ... আপনার initializeApp ফাংশন অপরিবর্তিত ...
    }

    async function loadAllTasks(category) {
        const container = document.getElementById('tasks-container');
        container.innerHTML = `<p style="text-align:center;">Loading tasks...</p>`;
        
        try {
            const [adminTasksSnapshot, promotionTasksSnapshot] = await Promise.all([
                firestoreDb.collection('tasks').where('category', '==', category).get(),
                firestoreDb.collection('promotions').where('category', '==', category).where('status', '==', 'active').get()
            ]);

            let adminTasksHTML = '';
            let promotionTasksHTML = '';

            // অ্যাডমিনের টাস্কগুলো প্রসেস করা হচ্ছে
            adminTasksSnapshot.forEach(doc => {
                adminTasksHTML += createTaskCardHTML(doc.id, doc.data());
            });

            // প্রমোশনগুলো প্রসেস করা হচ্ছে
            promotionTasksSnapshot.forEach(doc => {
                const promoData = doc.data();
                const taskData = {
                    title: promoData.title,
                    points: promoData.pointsPerTask,
                    url: promoData.url,
                    taskType: 'promotion' // প্রমোশনকে আলাদাভাবে চেনার জন্য
                };
                promotionTasksHTML += createTaskCardHTML(doc.id, taskData);
            });

            if (!adminTasksHTML && !promotionTasksHTML) {
                container.innerHTML = `<div class="no-tasks"><h3>No tasks available.</h3></div>`;
                return;
            }
            
            // চূড়ান্ত HTML তৈরি করা হচ্ছে
            container.innerHTML = `
                ${adminTasksHTML ? `<h2 class="section-title">Official Tasks</h2>${adminTasksHTML}` : ''}
                ${promotionTasksHTML ? `<h2 class="section-title">User Promotions</h2>${promotionTasksHTML}` : ''}
            `;
            
            // ইভেন্ট লিসেনারগুলো যোগ করা হচ্ছে
            attachEventListeners();

        } catch (error) {
            console.error("Error loading tasks:", error);
            container.innerHTML = `<div class="no-tasks"><h3>Could not load tasks.</h3></div>`;
        }
    }

    function createTaskCardHTML(taskId, task) {
        const isDaily = task.taskType === 'daily';
        const today = new Date().toISOString().slice(0, 10); // আজকের তারিখ YYYY-MM-DD ফরম্যাটে
        const isCompletedToday = localStorage.getItem(`task_${taskId}`) === today;

        return `
            <div class="task-card ${isDaily ? 'daily' : ''}">
                <div class="task-info">
                    <h3>${task.title || 'Untitled Task'}</h3>
                    <p class="points">+${task.points || 0} Points</p>
                </div>
                <div class="task-actions">
                    <button class="task-btn join-btn" data-url="${task.url || ''}">Join</button>
                    <button class="task-btn verify-btn" data-task-id="${taskId}" data-task-type="${task.taskType}" ${isCompletedToday ? 'disabled' : ''}>
                        ${isCompletedToday ? 'Completed' : 'Verify'}
                    </button>
                </div>
            </div>
        `;
    }

    function attachEventListeners() {
        document.querySelectorAll('.join-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const url = e.target.dataset.url;
                if (url) {
                    tg.openLink(url);
                } else {
                    tg.showAlert('Link for this task is not available.');
                }
            });
        });

        document.querySelectorAll('.verify-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const taskId = e.target.dataset.taskId;
                const taskType = e.target.dataset.taskType;
                
                // এখানে verify করার জন্য আপনার ব্যাকএন্ড API-কে কল করতে হবে
                // সফল হলে নিচের কাজগুলো করতে হবে:
                
                tg.showAlert(`Verification for task ${taskId} is in progress...`);
                
                if (taskType === 'daily') {
                    const today = new Date().toISOString().slice(0, 10);
                    localStorage.setItem(`task_${taskId}`, today);
                    e.target.disabled = true;
                    e.target.innerText = 'Completed';
                } else if (taskType !== 'promotion') { // General admin task
                    // এটি একবারই করা যাবে
                    e.target.disabled = true;
                    e.target.innerText = 'Completed';
                }
            });
        });
    }

    initializeApp();
});
</script>

</body>
</html>
